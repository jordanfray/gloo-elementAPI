<head>
    <meta name="viewport" content="width=device-width">
    <script type="text/javascript" src="gloo_assets_343/tyro_check-in_assets/javascript/jquery-1.11.1.min.js"></script>
    <link href="gloo_assets_343/tyro_check-in_assets/css/normalize.css" media="screen" rel="stylesheet" type="text/css">
    <link href="gloo_assets_343/tyro_check-in_assets/css/style.css" media="screen" rel="stylesheet" type="text/css">
    <script src="http://code.highcharts.com/highcharts.js"></script>
</head>

<style>    
    .highchart-line {
        width: 100%;
        height: 80vw;
    }
    
    #insight {
        display: none;
    }
    
    .highchart-pie {
        width: 100%;
        height: 300px;
    }
    
    h5 {
        font-size: 8vw;
        font-weight: 100;
        text-align: center;
        margin-bottom: -15vw;
        margin-top: -4vw;
    }
    
    .half-width {
        display: inline-block;
        width: 45vw;
    }
    
    #behavior-graph {
        margin-top: -17vw;
    }
    
    .highcharts-legend-item text {
        font-size: 5vw !important;
    }
    
    .scale label {
        display: inline-block;
        color: #444444;
        font-family: helvetica;
        font-size: 5vw;
        font-weight: 700;
        background: #f2f2f2;
        padding: 3vw 0;
        border-radius: 2vw;
        margin-right: 1vw;
        margin-bottom: 8vw;
        width: 10.9vw;
        text-align: center;
    }
</style>
<body>    
    <div id="questions">
        <img class="full-width" src="https://d1yyrsno1mfwjj.cloudfront.net/uploads/media/image/35522/open-uri20140918-25161-135wne">
        
        <div class="content-container">
            <p>How's your attitude today?</p>
            
            <div id="question1" class="answers scale">
                <input type="radio" id="radio-1-1" name="question1">
                <label for="radio-1-1">1</label>
            
                <input type="radio" id="radio-1-2" name="question1">
                <label for="radio-1-2">2</label>
                
                <input type="radio" id="radio-1-3" name="question1">
                <label for="radio-1-3">3</label>
                
                <input type="radio" id="radio-1-4" name="question1">
                <label for="radio-1-4">4</label>
                
                <input type="radio" id="radio-1-5" name="question1">
                <label for="radio-1-5">5</label>
                
                <input type="radio" id="radio-1-6" name="question1">
                <label for="radio-1-6">6</label>
                
                <input type="radio" id="radio-1-7" name="question1">
                <label for="radio-1-7">7</label>
            </div>  
        </div>
        
        <img class="full-width" src="https://d1yyrsno1mfwjj.cloudfront.net/uploads/media/image/35523/open-uri20140918-25161-4q2vr2">
        
        <div class="content-container">    
            <p>How much time did you spend with your children today (face to face)?</p>
            
            <div id="question1" class="answers row">
                <input type="radio" id="radio-2-0" name="question2">
                <label for="radio-2-0">None</label>
            
                <input type="radio" id="radio-2-1" name="question2">
                <label for="radio-2-1">1-2 hours</label>
                
                <input type="radio" id="radio-2-2" name="question2">
                <label for="radio-2-2">3-5 hours</label>
                
                <input type="radio" id="radio-2-3" name="question2">
                <label for="radio-2-3">5 or more</label>
            </div>
        </div>    
        
        <img class="full-width" src="https://d1yyrsno1mfwjj.cloudfront.net/uploads/media/image/35532/open-uri20140918-25161-18ntkkj">
        
        <div class="content-container">        
            <p>How much time did you spend with Lames today?</p>
            
            <div id="question1" class="answers row">
                <input type="radio" id="radio-3-0" name="question3">
                <label for="radio-3-0">None</label>
            
                <input type="radio" id="radio-3-1" name="question3">
                <label for="radio-3-1">1-2 hours</label>
                
                <input type="radio" id="radio-3-2" name="question3">
                <label for="radio-3-2">3-5 hours</label>
                
                <input type="radio" id="radio-3-3" name="question3">
                <label for="radio-3-3">5 or more</label>
            </div>
        </div>   
        
        <img class="full-width" src="https://d1yyrsno1mfwjj.cloudfront.net/uploads/media/image/35530/open-uri20140918-25161-rnpipd">
        
        <div class="content-container">
            <p>Did you stick to your fast today?</p>
            
            <div id="question1" class="answers two-column">
                <input type="radio" id="radio-4-0" name="question4">
                <label for="radio-4-0">No</label>
            
                <input type="radio" id="radio-4-1" name="question4">
                <label for="radio-4-1">Yes</label>
            </div>
            
            <p>Were you a TYRO today?</p>
            
            <div id="question1" class="answers two-column">
                <input type="radio" id="radio-5-0" name="question5">
                <label for="radio-5-0">No</label>
            
                <input type="radio" id="radio-5-1" name="question5">
                <label for="radio-5-1">Yes</label>
            </div>
            
            <a id="submit" class="btn full-width align-center disabled">Submit Answers</a>
        </div>
    </div>
    
    <div id="insight">
        <img class="full-width" src="gloo_assets_343/tyro_check-in_assets/images/myresults.jpg">
        <div class="content-container">
            <h1>TYRO Trend</h1>
            <p class="small">We analyze results from your TYRO Check-in to create your TYRO Trend. 
            If the line is Green, you were a TYRO that day. If the line is Red, you still have some work to do</p>
        </div>
        
        <div id="tyroTrendGraph" class="highchart-line"></div>
        
        <div class="content-container">
            <div class="light-rule"></div>
            <h1>Commitments</h1>
            <p class="small">The percentage of time you honored your commitments.</p><br>
            
            <div class="half-width">
                <h5>TYRO</h5>
                <div id="fastPie" class="highchart-line"></div>
            </div>
            
            <div class="half-width">
                <h5>FAST</h5>
                <div id="tyroPie" class="highchart-line"></div>
            </div>
        </div>
        
        <div id="behavior-graph">
            <div class="content-container">
                <div class="light-rule"></div>
                <h1>Behavior</h1>
                <p class="small">Your attitude and how you spent your time, on one graph.</p>
            </div>
            
            <div id="attitudeGraph" class="highchart-line"></div>
        </div>
        <br><br><br>
    </div>
    
    <script>
        $(document).ready(function() { // This makes sure the javascript dosen't run until the page and all of the external scripts load.
            var db = elementAPI.userData();
            
            // Get historicData from the databag and set it to an empty array if it is undefined
                var historicData = JSON.parse(db.getValue('historicData'));
                if ( historicData === null || historicData === undefined) {
                    historicData = [];
                };
            
            // Collect answers on click of each answer
                var todaysAnswers = [];
                
                $("input").click(function() {
                    var id = $(this).attr('id');
                    var params = id.split("-");
                    var questionID = params[1];
                    var answerID = params[2];
                    todaysAnswers[questionID] = answerID;
                    
                    // enable submit button once all questions have been answered
                    if ($('input[type=radio]:checked').size() == 5) {
                        $('#submit').removeClass('disabled');
                        $('#submit').removeAttr('disabled');
                    };
                });
            
            $("#submit").click(function() {
                var timestamp = new Date();
                var thisMonth = timestamp.getMonth();
                var date = thisMonth + "-" + timestamp.getDate();
                
                // Calculate TYRO Trend for Today
                    var tyroTrend = 
                    parseInt(todaysAnswers[1]) + 
                    parseInt(todaysAnswers[2]*2) + 
                    parseInt(todaysAnswers[3]*-4) + 
                    parseInt((todaysAnswers[4] == 0) ? -3 : 3) + 
                    parseInt((todaysAnswers[5] == 0) ? -3 : 3);
                
                // Calculate Time with Kids
                    var timeWithKids = parseInt(todaysAnswers[2]);
                
                // Calculate Time with Lames
                    var timeWithLames = parseInt(todaysAnswers[3]);
                    
                // Calculate % for Fast
                    var keptFast = parseInt(todaysAnswers[4]);
                    
                    if ( keptFast === 1 ) {
                        keptFast = "true";
                    } else {
                        keptFast = "false";
                    };
                    
                // Calculate % for TYRO
                    var wasTyro = parseInt(todaysAnswers[5]);
                    
                    if ( wasTyro === 1 ) {
                        wasTyro = "true";
                    } else {
                        wasTyro = "false";
                    };
                
                // Calculate attitude for Today
                    var attitude = parseInt(todaysAnswers[1]);
                
                // Save today's data
                    var todaysData = [                      //INDEX
                        {"date":date},                      // 0
                        {"tyroTrend":tyroTrend},            // 1
                        {"keptFast":keptFast},              // 2
                        {"wasTyro":wasTyro},                // 3
                        {"attitude":attitude},              // 4
                        {"timeWithKids":timeWithKids},      // 5
                        {"timeWithLames":timeWithLames}     // 6
                    ];
                    
                    elementAPI.createAnalyticEvent('tyroCheckin', JSON.stringify(todaysData)); // Send analytic event
                    
                    if ( historicData.length >= 7 ) {
                        historicData.shift();
                        historicData.push(todaysData);
                        db.setValue("historicData", JSON.stringify(historicData));
                        console.log(historicData);
                    } else {
                        historicData.push(todaysData);
                        db.setValue("historicData", JSON.stringify(historicData));
                        console.log(historicData);
                    };
                
                // Set Dates for X-axis
                    var dates = [];
                    
                    for ( var i=0; i < historicData.length; i++ ) {
                        dates[i] = historicData[i][0]['date'];
                    };
                    
                // Set TYRO Trend series data
                    var tyroTrendData = [];
                    
                    for ( var i=0; i < historicData.length; i++ ) {
                        tyroTrendData[i] = historicData[i][1]['tyroTrend'];
                    };
                
                // Calculate % that user kept fast
                    var keptFastData = 0;
                    
                    for ( var i=0; i < historicData.length; i++ ) {
                        if ( historicData[i][2]['keptFast'] === "true" ) {
                            keptFastData ++;
                        };
                    };
                    
                    keptFastData = keptFastData/historicData.length;
                    
                // Calculate % that user kept fast
                    var wasTyro = 0;
                    
                    for ( var i=0; i < historicData.length; i++ ) {
                        if ( historicData[i][3]['wasTyro'] === "true" ) {
                            wasTyro ++;
                        };
                    };
                    
                    wasTyro = wasTyro/historicData.length;
                
                // Set Attitude series data
                    var attitudeData = [];
                    
                    for ( var i=0; i < historicData.length; i++ ) {
                        attitudeData[i] = historicData[i][4]['attitude'];
                    };
                    
                // Set Time With Kids series data
                    var kidsData = [];
                    
                    for ( var i=0; i < historicData.length; i++ ) {
                        kidsData[i] = historicData[i][5]['timeWithKids'];
                    };
                    
                // Set Time With Lames series data
                    var lameData = [];
                    
                    for ( var i=0; i < historicData.length; i++ ) {
                        lameData[i] = historicData[i][6]['timeWithLames'];
                    };
                    
                // Hide Questions and show insight - Scroll to the top of the page
                    $("#questions").hide();
                    $("#insight").show();
                    $(window).scrollTop(0);
                
                // Set reminder to take the check-in again in 24 hours (1,400 minutes)
                    //elementAPI.sendMessage("It's time for your TYRO Check-In!", 1440, true);
                    
                //TYRO Trend Graph - HIGHCHARTS
                    $(function () {
                        $('#tyroTrendGraph').highcharts({
                            chart: {
                                backgroundColor: 'rgba(0,0,0,0)',
                                type: 'areaspline'
                            },
                            credits: {
                                enabled: false
                            },
                            legend: {
                                enabled: false
                            },
                            title: {
                                text: null
                            },
                            xAxis: {
                                tickmarkPlacement: 'on',
                                startOnTick: true,
                                minPadding: 0,
                                endOnTick: false,
                                maxPadding: 0,
                                categories: [
                                    dates[0],
                                    dates[1],
                                    dates[2],
                                    dates[3],
                                    dates[4],
                                    dates[5],
                                    dates[6]
                                ]
                            },
                            yAxis: {
                                labels: {
                                    enabled: false
                                },
                                plotBands: [{
                                    from: -40,
                                    to: 0,
                                    color: 'rgba(246, 195, 164, .3)'
                                },
                                {
                                    from: 0,
                                    to: 40,
                                    color: 'rgba(202, 246, 164, .3)'
                                }
                                ],
                                title: null,
                                floor: -18,
                                ceiling: 20
                            },
                            credits: {
                                enabled: false
                            },
                            series: [{
                                name: 'TYRO TREND',
                                color: '#2e8b57',
                                negativeColor: '#cc3333',
                                data: [
                                    tyroTrendData[0],
                                    tyroTrendData[1],
                                    tyroTrendData[2],
                                    tyroTrendData[3],
                                    tyroTrendData[4],
                                    tyroTrendData[5],
                                    tyroTrendData[6],
                                ]
                            }]
                        });
                    });
                
                // Fast Pie Chart - HIGHCHARTS
                $(function () {
                    $('#fastPie').highcharts({
                        chart: {           
                            backgroundColor: 'rgba(0,0,0,0)',
                            margin: [0, 0, 0, 0],
                            spacingTop: 0,
                            spacingBottom: 0,
                            spacingLeft: 0,
                            spacingRight: 0
                        },
                        credits: {
                                enabled: false
                            },
                        title: {
                            text: null
                        },
                        tooltip: {
                            pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
                        },
                        plotOptions: {
                            pie: {
                                size:'100%',
                                dataLabels: {
                                    enabled: false
                                },
                                allowPointSelect: false,
                                cursor: 'pointer',
                                dataLabels: {
                                    distance: -30,
                                    color: 'white',
                                    enabled: true,
                                    format: '<b>{point.name}</b>',
                                    style: {
                                        color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
                                    }
                                }
                            }
                        },
                        series: [{
                            type: 'pie',
                            name: 'Kept Fast',
                            data: [
                                ['YES', keptFastData],
                                ['NO', (1-keptFastData)],
                            ]
                        }]
                    });
                }); // End of Fast Pie Chart Graph
                
                // TYRO Pie Chart - HIGHCHARTS
                $(function () {
                    $('#tyroPie').highcharts({
                        chart: {           
                            backgroundColor: 'rgba(0,0,0,0)',
                            margin: [0, 0, 0, 0],
                            spacingTop: 0,
                            spacingBottom: 0,
                            spacingLeft: 0,
                            spacingRight: 0
                        },
                        credits: {
                                enabled: false
                            },
                        title: {
                            text: null
                        },
                        tooltip: {
                            pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
                        },
                        plotOptions: {
                            pie: {
                                size:'100%',
                                dataLabels: {
                                    enabled: false
                                },
                                allowPointSelect: false,
                                cursor: 'pointer',
                                dataLabels: {
                                    distance: -30,
                                    color: 'white',
                                    enabled: true,
                                    format: '<b>{point.name}</b>',
                                    style: {
                                        color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
                                    }
                                }
                            }
                        },
                        series: [{
                            type: 'pie',
                            name: 'was TYRO',
                            data: [
                                ['YES', wasTyro],
                                ['NO', (1-wasTyro)],
                            ]
                        }]
                    });
                }); // End of Fast Pie Chart Graph
                
                //Attitude, TimeWithKids, TimeWithLames - HIGHCHARTS
                    $(function () {
                        $('#attitudeGraph').highcharts({
                            chart: {
                                backgroundColor: 'rgba(0,0,0,0)',
                                type: 'areaspline'
                            },
                            credits: {
                                enabled: false
                            },
                            legend: {
                                enabled: true,
                                layout: 'vertical',
                                align: 'bottom'
                            },
                            title: {
                                text: null
                            },
                            xAxis: {
                                tickmarkPlacement: 'on',
                                startOnTick: true,
                                minPadding: 0,
                                endOnTick: false,
                                maxPadding: 0,
                                categories: [
                                    dates[0],
                                    dates[1],
                                    dates[2],
                                    dates[3],
                                    dates[4],
                                    dates[5],
                                    dates[6]
                                ]
                            },
                            yAxis: {
                                labels: {
                                    enabled: false
                                },
                                title: null,
                                floor: -18,
                                ceiling: 20
                            },
                            credits: {
                                enabled: false
                            },
                            series: [{
                                name: 'Attitude',
                                color: '#f7951e',
                                data: [
                                    attitudeData[0],
                                    attitudeData[1],
                                    attitudeData[2],
                                    attitudeData[3],
                                    attitudeData[4],
                                    attitudeData[5],
                                    attitudeData[6],
                                ]
                            },
                            {
                                name: 'Time With Kids',
                                color: '#fecd08',
                                data: [
                                    kidsData[0],
                                    kidsData[1],
                                    kidsData[2],
                                    kidsData[3],
                                    kidsData[4],
                                    kidsData[5],
                                    kidsData[6],
                                ]
                            },
                            {
                                name: 'Time With Lames',
                                color: '#898989',
                                data: [
                                    lameData[0],
                                    lameData[1],
                                    lameData[2],
                                    lameData[3],
                                    lameData[4],
                                    lameData[5],
                                    lameData[6],
                                ]
                            }]
                        });
                    });
            }); // END of Submit function
            
        }); // End Document Ready
    </script>
</body>